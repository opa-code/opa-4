# Build Windows version using Lazarus

name: Build Windows executable

# Controls when the workflow will run
# Triggers the workflow on push or pull request events but only for the "main" branch
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel     
jobs:
  build:
    # The type of runner that the job will run on
    runs-on: windows-latest

  # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
        # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download Lazarus installer
        shell: powershell
        run: |
          curl.exe -L -o lazarus-installer.exe https://sourceforge.net/projects/lazarus/files/Lazarus%20Windows%2064%20bits/Lazarus%204.2/lazarus-4.2-fpc-3.2.2-win64.exe/download
          
      - name: Install Lazarus silently
        shell: powershell
        run: |
          Start-Process -FilePath "lazarus-installer.exe" -ArgumentList "/VERYSILENT" -Wait

      - name: Add Lazarus to PATH
        shell: powershell
        run: |
          $env:PATH += ";C:\lazarus\"
          [Environment]::SetEnvironmentVariable("PATH", $env:PATH, "Machine")
          lazbuild --version

              #shell: bash
              #run: |
              #  choco install lazarus --version=3.0 --yes
              #  echo "Lazarus installed."
              #  lazbuild --version

      #- name: üèóÔ∏è Build Lazarus project
      #  shell: bash
      #  run: |
      #    echo "Building project..."
      #    lazbuild --build-mode=Release opa4/opa.lpi

      #- name: üì¶ Upload built executable
      #  uses: actions/upload-artifact@v4
      #  with:
      #    name: opa-exe
      #    path: |
      #      opa4/*.exe
